{% extends 'layout.html.twig' %}

{% block content %}

<div class="row">
    <div class="col-lg-12">
        <h1 class="page-header">KPI Project Details</h1>
        <ol class="breadcrumb">
        	{% if Month is defined and Month is not empty %}
            	<li><a href="{{ path('DashboardMonth', { Month : Month }) }}">Dashboard</a></li>
            {% else %}
            	<li><a href="{{ path('Dashboard') }}">Dashboard</a></li>
            {% endif %}
            <li class="active"> Project Details for KPI - <strong>{{ KPI }}</strong></li>
        </ol>
    </div>
</div>
<div class="text-primary"><strong>Target for this KPI ( {{ KPIData['OPERATOR'] }}{{ KPIData['SLA_VALUE'] }} )</strong></div></br>
<div class="col-sm-10">
	<table id="dataTable" class="table table-bordered table-hover table-sm">
		<thead class="thead-inverse">
			<tr>					
				<th class="bg_grey col-md-1">S.No.</th>
				<th class="bg_grey">Projects</th>			
				<th class="bg_grey">{{ KPI }}</th>
				<th class="bg_grey">RAG</th>
				<th class="bg_grey">Cause</th>
				<th class="bg_grey">Action</th>
			</tr>					
		</thead>
		<tbody>									
			{% for row in KPIResults %}		
			{% set action = '' %}	
			{% set RAG = '' %}
				<tr>
					<td class="col-md-1">{{ loop.index }}</td>						
					<td>{{ row['Project'] }}</td>					
					{% if row['Actual'] == 'N/A' %}
						{% set action = "" %}
						<td style="cursor:help" data-toggle="tooltip" data-html="true" title="{{ row['Formula']}}" class="bg_grey">{{ row['Actual'] }}</td>
					{% else %}
						{% if row['Operator'] == '<=' %}
							{% if row['Actual'] <= row['Target'] %}
								{% set RAG = 'green' %}		
								<td style="cursor:help" data-toggle="tooltip" data-html="true" title="{{ row['Formula']}}" class="bg-success">{{ row['Actual'] }}%</td>						
							{% else %}
								{% set action = 1 %}
								{% set RAG = 'red' %}
								<td style="cursor:help" data-toggle="tooltip" data-html="true" title="{{ row['Formula']}}" class="bg-danger">{{ row['Actual'] }}%</td>
							{% endif %}						
						{% elseif row['Operator'] == '>=' %}
							{% if row['Actual'] >= row['Target'] %}
								{% set RAG = 'green' %}		
								<td style="cursor:help" data-toggle="tooltip" data-html="true" title="{{ row['Formula']}}" class="bg-success">{{ row['Actual'] }}%</td>						
							{% else %}
								{% set action = 1 %}
								{% set RAG = 'red' %}
								<td style="cursor:help" data-toggle="tooltip" data-html="true" title="{{ row['Formula']}}" class="bg-danger">{{ row['Actual'] }}%</td>
							{% endif %}				
						{% endif %}
					{% endif %}
					
					<td align="center">
						{% if RAG is defined and RAG == 'green' %}
							<img src="{{ asset("images/green_RAG.png") }}">
						{% elseif RAG is defined and RAG == 'red' %}
							<img src="{{ asset("images/red_RAG.png") }}">
						{% else %}
							<img src="{{ asset("images/na_RAG.png") }}">
						{% endif %}
					</td>		
					
					{% if action is defined and action == 1 %}
						{# {{ row['Action'] | wordwrap(20) }} #}
						<td contenteditable="true" id="CAUSE_{{ loop.index }}" class="col-md-5">{{ row['Cause'] }}</td>						
						<td contenteditable="true" id="ACTION_{{ loop.index }}" class="col-md-5">{{ row['Action'] }}</td>	
					{% else %}						
						<td class="bg_grey">N/A</td>						
						<td class="bg_grey">N/A</td>			
					{% endif %}
					
					<input type="hidden" name="KPIHidden" id="KPIHidden" value="{{ KPIData['KPI_ID'] }}">
					<input type="hidden" name="ProjectIDHidden" id="ProjectIDHidden_{{ loop.index }}" value="{{ row['ProjectID'] }}">
					
								
				</tr>
			{% endfor %}		
			
		<div id="dialog" class="modal_dialog" title="Action Status"></div> 							
		</tbody>
	</table>
</div>	

{% endblock %}

{% block javascripts %}
	{{ parent() }}
	<script src="{{ asset('js/Dashboard/Dashboard_common.js') }}"></script>		
	<script>
		{# loadDataTable_Export('KPIResults'); #}
		{# DashboardGeneralFunctions(); #}
		OnTDBlurEditValues();	
		
	</script>	
{% endblock %}

{% block documentready %}
	<script>
		$('[data-toggle="tooltip"]').tooltip({
			html: true,			
    		max-width:none
		});
	</script>
{% endblock %}